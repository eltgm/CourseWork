//
// Created by Ильдар on 23.12.2018.
//

#include "../headers/application.h"

const string HELLO = "................................................................................\n"
                     "....................................................=????+,.....................\n"
                     "..................................................+++++++++=++..................\n"
                     "................................................:++++++++++++==.................\n"
                     "................................................++++????++++??+.................\n"
                     "...............................................,=+++????++++???+................\n"
                     "...............................................=++++????+++++?++................\n"
                     "...............................................=~~++=~=+++?++??+................\n"
                     ".............=?:...............................~:~=?+~:=++++++==................\n"
                     ".............=?+...............................+==++?+++??+++=~+................\n"
                     ".............~+?...............................=+++?+??+?++++=?+................\n"
                     "............:=+?+..............................=+~::=?+++++++=+.................\n"
                     "..........+?+????..............................,+?==??+++++==~..................\n"
                     ".........:+++?~==:..............................~:=++=~=+++==~..................\n"
                     ".........~++=++++:..............................~~=++++=+====~..................\n"
                     ".........~=++?I?+:..................,,....,,,,:,~:~==========?,,................\n"
                     "..........=+?=~~=7:..............,,,,,,,,,,,,,,,,.~=++++===+~,?+,...............\n"
                     "...........~~~~~=7,...............,,,,,,.,..,,,,,,.,,.,,,,,,,777,,,.............\n"
                     "............,::~=~.,...........,,..,.,,,,........,,,,,~::,,,7777,,,,,,,,........\n"
                     "............:~~?+=,..,...............,,,,......,,,,,~777?::+7777,,,,,,,,,,,,....\n"
                     "...........,=:~~+..........,..,...........,....,,,.777?+7777777:,,,,....,,,,,,,.\n"
                     "...........,=+=.......................,,,,,.....,,,777777777777,,,,.....,,,,,,,,\n"
                     "...........,..............................,,...,,,,77777777777?,,,,...,,,,,,,,,,\n"
                     "............,,..........................,,,,,.,,,,:77777777777,,,,,...,,,,,,..,.\n"
                     ".........................................,,,,,.,,,:77777777777,,,,,,,.,,,,,..,..\n"
                     "...............,,.........................,,,,.,,,,777I777777,,,,,,.,.,,,,,.....\n"
                     "................,,.........................,,,,,,,,777777777I,,,,,,,,.,,,.......\n"
                     "..................,,..:::::::..............,,,,,,,,777777777,,,,,,,,............\n"
                     ".................................:..........,,,,,,:77777777,,,,,,,,,............\n"
                     ".................................:..........,,,,,,:I777777=,,,.,,..........,....\n"
                     "\n"
                     "\n"
                     " ______   ______     __         ______        ______     __  __     __  __     _____     ______     ______    \n"
                     "/\\  == \\ /\\  __ \\   /\\ \\       /\\  ___\\      /\\  ___\\   /\\ \\_\\ \\   /\\ \\/\\ \\   /\\  __-.  /\\  ___\\   /\\  ___\\   \n"
                     "\\ \\  _-/ \\ \\ \\/\\ \\  \\ \\ \\____  \\ \\  __\\      \\ \\ \\____  \\ \\  __ \\  \\ \\ \\_\\ \\  \\ \\ \\/\\ \\ \\ \\  __\\   \\ \\___  \\  \n"
                     " \\ \\_\\    \\ \\_____\\  \\ \\_____\\  \\ \\_____\\     \\ \\_____\\  \\ \\_\\ \\_\\  \\ \\_____\\  \\ \\____-  \\ \\_____\\  \\/\\_____\\ \n"
                     "  \\/_/     \\/_____/   \\/_____/   \\/_____/      \\/_____/   \\/_/\\/_/   \\/_____/   \\/____/   \\/_____/   \\/_____/"
                     "\n\n\n"
                     "Добрый вечер! Здравствуйте, уважаемые дамы и господа! Пятница! В эфире капитал-шоу «Поле чудес»!\nИ как обычно, под аплодисменты зрительного зала я приглашаю в студию первого игрока. Первый игрок, в студию!\n";

application::application() = default;

void application::build_tree_utilities() {
    cout << HELLO;

    string name;
    string lives = "abc";

    cout << "Представьтесь, пожалуйста!\n";
    cin >> name;
    game.set_username(name);

    bool flag = false;
    while (!flag) {
        cout << "Сколько попыток?\n";
        cin >> lives;

        flag = is_number(lives);
    }

    game.set_lives(stoi(lives));

    cout << "Как играть:\n"
            "После появления специального сообщения, введите 1(ровно 1!) символ кириллицы. Дождитесь результата.";

    game.load_strings();
}

bool application::is_number(const std::string &s) {
    std::string::const_iterator it = s.begin();
    while (it != s.end() && std::isdigit(*it)) ++it;
    return !s.empty() && it == s.end();
}

int application::start_game() {
    game.set_full_string();

    while (true) {
        screen_updater.update_state(game.get_username(), game.get_user_string(), game.get_lives());
        if (game.get_lives() <= 0) {
            cout << "Вы проиграли, но в скрижалях «Поля Чудес» вы навсегда остаетесь победителем!\n\n";
            cout << "Загаданное слово - " << game.get_conceived_string() << "\n";
            system("pause");
            return -1;
        }

        char ch;
        cout << game.get_username() + ", введите букву!\n";
        cin >> ch;

        if (ch == '0') {
            cout
                    << "С вами мы прощаемся ровно на одну неделю. Желаем удачи хотя бы на эти коротенькие семь дней. Дай вам Бог.";
            cout << "Загаданное слово - " << game.get_conceived_string() << "\n";
            return 0;
        }

        bool ans = game.check_char(ch);
        if (ans) {
            cout << "Есть такая буква в этом слове!\n";
        } else {
            cout << "Пусть откроют, но в другом слове.\n";
        }

        if (game.end_game()) {
            cout << "И перед нами финалист капитал-шоу «Поле чудес»!\n\n";
            system("pause");
            return 1;
        }
    }
}
